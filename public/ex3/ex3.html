<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supermarket</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
    crossorigin="anonymous"
  />

  <!-- Axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
  <div class="container-fluid my-4">
    <h1 class="text-center mb-4">Supermarket</h1>

    <div class="row mb-3">
      <div class="col-md-3 text-end">
        <label for="selectCategory" class="lead">Category</label>
      </div>
      <div class="col-md-9">
        <select class="form-select" id="selectCategory">
          <option value="0">To select</option>
          <option value="all">All</option>
        </select>
      </div>
    </div>

    <div id="itemsList" class="row my-3 py-3">
      <!-- Items will be injected here -->
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      getCategories();

      const dropdown = document.getElementById('selectCategory');
      dropdown.addEventListener('change', getItems);
    });

    async function getCategories() {
      try {
        const response = await axios.get('http://localhost:3000/categories');
        showCategories(response.data);
      } catch (error) {
        console.error('❌ Error fetching categories:', error);
        clearItems();
        showMessage('Failed to load categories. Is the server running?');
      }
    }

    function showCategories(categories) {
      const selectElement = document.getElementById('selectCategory');

      // Remove all options except the first two
      while (selectElement.children.length > 2) {
        selectElement.removeChild(selectElement.lastChild);
      }

      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        selectElement.appendChild(option);
      });
    }

    async function getItems() {
      const selectedCategory = document.getElementById('selectCategory').value;
      if (selectedCategory === '0') {
        clearItems();
        showMessage('Please select a category');
        return;
      }

      try {
        let url = 'http://localhost:3000/items';
        if (selectedCategory !== 'all') {
          url += `?category=${selectedCategory}`;
        }

        const response = await axios.get(url);
        showItems(response.data);
      } catch (error) {
        console.error('❌ Error fetching items:', error);
        clearItems();
        showMessage('Failed to load items. Check server status.');
      }
    }

    function clearItems() {
      const itemsList = document.getElementById('itemsList');
      while (itemsList.firstChild) {
        itemsList.removeChild(itemsList.firstChild);
      }
    }

    function showMessage(message) {
      const itemsList = document.getElementById('itemsList');
      clearItems();

      const p = document.createElement('p');
      p.className = 'text-center text-info';
      p.textContent = message;
      itemsList.appendChild(p);
    }

    function showItems(items) {
      clearItems();
      const itemsList = document.getElementById('itemsList');

      if (items.length === 0) {
        showMessage('No items found for this category');
        return;
      }

      items.forEach(item => {
        const col = document.createElement('div');
        col.className = 'col-12 col-md-6 col-lg-4 mb-3';

        const card = document.createElement('div');
        card.className = 'card h-100';

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        const title = document.createElement('h5');
        title.className = 'card-title';
        title.textContent = item.name;

        const price = document.createElement('p');
        price.className = 'card-text';
        price.textContent = `Price: $${item.price.toFixed(2)}`;

        const button = document.createElement('button');
        button.className = 'btn btn-primary';
        button.textContent = 'Add to Cart';
        button.addEventListener('click', () => {
          alert(`Added ${item.name} ($${item.price.toFixed(2)}) to cart!`);
        });

        cardBody.appendChild(title);
        cardBody.appendChild(price);
        cardBody.appendChild(button);
        card.appendChild(cardBody);
        col.appendChild(card);
        itemsList.appendChild(col);
      });
    }
  </script>

  <!-- Bootstrap JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"
  ></script>
</body>
</html>